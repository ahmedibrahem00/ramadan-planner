<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù…Ù†Ø¸Ù‘Ù… Ø±Ù…Ø¶Ø§Ù† Ø§Ù„ÙŠÙˆÙ…ÙŠ</title>
  <style>
    :root {
      --bg: #0f172a;
      --card: #111827;
      --primary: #22c55e;
      --gold: #facc15;
      --text: #e5e7eb;
      --muted: #9ca3af;
    }
    * { box-sizing: border-box; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    body {
      margin: 0; background: radial-gradient(circle at top, #0b1220, #020617);
      color: var(--text);
      min-height: 100vh;
    }
    header {
      padding: 24px 16px; text-align: center;
    }
    header h1 { margin: 0 0 8px; font-size: 28px; color: var(--gold); }
    header p { margin: 0; color: var(--muted); }

    .container { max-width: 1100px; margin: 0 auto; padding: 16px; display: grid; gap: 16px; }

    .card {
      background: linear-gradient(180deg, #0b1220, #020617);
      border: 1px solid #1f2933;
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .card h2 { margin-top: 0; color: #a7f3d0; }

    .grid { display: grid; gap: 12px; }
    .grid-2 { grid-template-columns: 1fr 1fr; }

.archive-grid {
  display: grid;
  gap: 14px;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  margin-top: 15px;
}

.archive-wrapper {
  overflow: hidden;
  max-height: 0;
  transition: max-height .5s ease;
}

.archive-wrapper.open {
  max-height: 2000px;
}

    @media (max-width: 640px) {
      .grid-2 { grid-template-columns: 1fr; }
      header h1 { font-size: 24px; }
    }

    .checklist label {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 12px; border-radius: 12px;
      background: rgba(31,41,51,.6); cursor: pointer;
    }
    .checklist input { width: 20px; height: 20px; }

    .actions { display: grid; gap: 10px; }
    .btn {
      border: 0; border-radius: 12px; padding: 12px 14px;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22; font-weight: 700; cursor: pointer;
    }
    .btn.secondary {
      background: transparent; color: var(--text); border: 1px solid #1f2933;
    }

    .archive-item {
      border: 1px solid #1f2933; border-radius: 12px; padding: 14px;
      background: rgba(2,6,23,.6);
      transition: .3s;
    }
    .archive-item:hover {
      transform: translateY(-3px);
      border-color: #22c55e;
    }

    footer { text-align: center; color: var(--muted); padding: 24px 12px; }
    .badge { color: #a7f3d0; font-weight: 700; }
    .rating-box {
      margin-top:10px;
      font-size:18px;
      color: var(--gold);
      font-weight:bold;
    }
  </style>
</head>
<body>

<header>
  <h1>Ù…Ù†Ø¸Ù‘Ù… Ø±Ù…Ø¶Ø§Ù† Ø§Ù„ÙŠÙˆÙ…ÙŠ ğŸŒ™</h1>
  <p>Ù†Ø¸Ù‘Ù… ØµÙ„Ø§ØªÙƒ ÙˆÙˆØ±Ø¯Ùƒ ÙˆØ°ÙƒØ±Ùƒ ÙŠÙˆÙ… Ø¨ÙŠÙˆÙ… Ù„Ø­Ø¯ Ø¢Ø®Ø± Ø±Ù…Ø¶Ø§Ù†</p>
</header>

<main class="container">
  <section class="card">
    <h2>ğŸ“… ÙŠÙˆÙ…Ùƒ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡</h2>
    <div id="todayDate" class="badge"></div>

    <div class="grid grid-2" style="margin-top:12px">
      <div class="card">
        <h3>ğŸ•Œ Ø§Ù„ØµÙ„ÙˆØ§Øª</h3>
        <div class="checklist">
          <label><input type="checkbox" data-key="fajr"> Ø§Ù„ÙØ¬Ø±</label>
          <label><input type="checkbox" data-key="dhuhr"> Ø§Ù„Ø¸Ù‡Ø±</label>
          <label><input type="checkbox" data-key="asr"> Ø§Ù„Ø¹ØµØ±</label>
          <label><input type="checkbox" data-key="maghrib"> Ø§Ù„Ù…ØºØ±Ø¨</label>
          <label><input type="checkbox" data-key="isha"> Ø§Ù„Ø¹Ø´Ø§Ø¡</label>
        </div>
      </div>

      <div class="card">
        <h3>ğŸ“– Ø§Ù„Ù‚Ø±Ø¢Ù†</h3>
        <div class="checklist">
          <label><input type="checkbox" data-key="wird"> ÙˆØ±Ø¯ Ø§Ù„ÙŠÙˆÙ… Ø§ØªÙ‚Ø±ÙŠ</label>
        </div>
        <h3 style="margin-top:10px">ğŸ¤² Ø§Ù„Ø£Ø°ÙƒØ§Ø±</h3>
        <div class="checklist">
          <label><input type="checkbox" data-key="morning"> Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­</label>
          <label><input type="checkbox" data-key="evening"> Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡</label>
          <label><input type="checkbox" data-key="salawat"> ØµÙ„Ø§Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ</label>
        </div>
      </div>
    </div>

    <div class="rating-box">
      â­ ØªÙ‚ÙŠÙŠÙ…Ùƒ Ø§Ù„ÙŠÙˆÙ…: <span id="autoRating">0 / 5</span>
    </div>

    <div class="actions" style="margin-top:12px">
      <button class="btn" id="finishDay">âœ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ… ÙˆØ­ÙØ¸Ù‡ ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ</button>
      <button class="btn secondary" id="resetToday">â™»ï¸ ØªØµÙÙŠØ± Ø§Ù„ÙŠÙˆÙ…</button>
    </div>
  </section>

<section class="card">
  <h2>ğŸ“‚ Ø§Ù„Ø£Ø±Ø´ÙŠÙ</h2>

  <button class="btn secondary" id="toggleArchive">
    ğŸ“‚ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø´ÙŠÙ
  </button>

  <div class="archive-wrapper" id="archiveWrapper">
    <div id="archiveList" class="archive-grid"></div>
  </div>
</section>

  <section class="card">
    <h2>ğŸ“Š Ù…Ù„Ø®Øµ Ø±Ù…Ø¶Ø§Ù†</h2>
    <div id="summary" class="grid"></div>
  </section>
</main>

<footer>
  Ø±Ø¨Ù†Ø§ ÙŠØªÙ‚Ø¨Ù„ Ù…Ù†ÙƒÙ… ÙˆÙŠØ¹ÙŠÙ†ÙƒÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§Ø¹Ø© Ø§Ø®ÙˆÙƒÙ… Ø§Ø­Ù…Ø¯ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… ğŸ¤
</footer>

<script>
  const todayKey = () => new Date().toISOString().slice(0,10);
  const getStore = () => JSON.parse(localStorage.getItem('ramadan-tracker') || '{"archive":{}}');
  const setStore = (data) => localStorage.setItem('ramadan-tracker', JSON.stringify(data));

  const todayDateEl = document.getElementById('todayDate');
  const archiveList = document.getElementById('archiveList');
  const summaryEl = document.getElementById('summary');
  const autoRatingEl = document.getElementById('autoRating');

  const allKeys = ['fajr','dhuhr','asr','maghrib','isha','wird','morning','evening','salawat'];

  function formatDate(dStr){
    const d = new Date(dStr);
    return d.toLocaleDateString('ar-EG', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
  }

  function calculateRating(data){
    const done = allKeys.filter(k => data[k]).length;
    return Math.round((done / allKeys.length) * 5);
  }

  function recalculateOldRatings() {
  const store = getStore();
  if (!store.archive) return;

  Object.keys(store.archive).forEach(date => {
    const dayData = store.archive[date];
    dayData.rating = calculateRating(dayData);
  });

  setStore(store);
}

  function updateAutoRating(){
    const store = getStore();
    const today = store[todayKey()] || {};
    const rating = calculateRating(today);
    autoRatingEl.textContent = rating + " / 5";
    return rating;
  }

  function loadToday(){
    todayDateEl.textContent = formatDate(todayKey());
    const store = getStore();
    const today = store[todayKey()] || {};
    document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
      cb.checked = !!today[cb.dataset.key];
    });
    updateAutoRating();
  }

  document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
    cb.addEventListener('change', () => {
      const store = getStore();
      store[todayKey()] = store[todayKey()] || {};
      store[todayKey()][cb.dataset.key] = cb.checked;
      store[todayKey()].rating = calculateRating(store[todayKey()]);
      setStore(store);
      updateAutoRating();
    });
  });

  document.getElementById('finishDay').onclick = () => {
    const store = getStore();
    const todayData = store[todayKey()] || {};
    store.archive = store.archive || {};
    store.archive[todayKey()] = { ...todayData, date: todayKey() };
    delete store[todayKey()];
    setStore(store);
    loadArchive();
    resetToday();
    alert('Ø§ØªØ­ÙØ¸ ÙŠÙˆÙ…Ùƒ ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ âœ¨');
  };

  document.getElementById('resetToday').onclick = resetToday;

  function resetToday(){
    document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
    const store = getStore();
    delete store[todayKey()];
    setStore(store);
    updateAutoRating();
  }

  function loadArchive(){
    const store = getStore();
    const items = Object.values(store.archive || {}).sort((a,b)=> b.date.localeCompare(a.date));
    archiveList.innerHTML = items.map(d => {
      const prayers = ['fajr','dhuhr','asr','maghrib','isha'].filter(k => d[k]).length;
      return `
        <div class="archive-item">
          <div><strong>ğŸ“… ${formatDate(d.date)}</strong></div>
          <div>ğŸ•Œ Ø§Ù„ØµÙ„ÙˆØ§Øª: ${prayers}/5</div>
          <div>ğŸ“– Ø§Ù„Ù‚Ø±Ø¢Ù†: ${d.wird ? 'ØªÙ…' : 'â€”'}</div>
          <div>ğŸ¤² Ø§Ù„Ø£Ø°ÙƒØ§Ø±: ${['morning','evening','salawat'].filter(k=>d[k]).length}/3</div>
          <div>â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${d.rating || 0} / 5</div>
        </div>
      `;
    }).join('') || '<p style="color:#9ca3af">Ù„Ø³Ù‡ Ù…ÙÙŠØ´ Ø£ÙŠØ§Ù… Ù…Ø­ÙÙˆØ¸Ø©.</p>';
    loadSummary(items);
  }

  const archiveWrapper = document.getElementById("archiveWrapper");
const toggleBtn = document.getElementById("toggleArchive");

toggleBtn.addEventListener("click", () => {
  archiveWrapper.classList.toggle("open");

  if (archiveWrapper.classList.contains("open")) {
    toggleBtn.textContent = "âŒ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø±Ø´ÙŠÙ";
  } else {
    toggleBtn.textContent = "ğŸ“‚ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø´ÙŠÙ";
  }
});

  function loadSummary(items){
    if(!items.length){
      summaryEl.innerHTML = '<p style="color:#9ca3af">Ø§Ø¨Ø¯Ø£ Ø£ÙˆÙ„ ÙŠÙˆÙ… ÙˆÙ‡ØªØ´ÙˆÙ Ø§Ù„Ù…Ù„Ø®Øµ Ù‡Ù†Ø§ âœ¨</p>';
      return;
    }

    const fullDays = items.filter(d => allKeys.every(k => d[k])).length;
    const avgRating = (items.reduce((s,d)=> s + (d.rating||0), 0) / items.length).toFixed(1);

    const names = {
      fajr:'Ø§Ù„ÙØ¬Ø±', dhuhr:'Ø§Ù„Ø¸Ù‡Ø±', asr:'Ø§Ù„Ø¹ØµØ±', maghrib:'Ø§Ù„Ù…ØºØ±Ø¨', isha:'Ø§Ù„Ø¹Ø´Ø§Ø¡',
      wird:'ÙˆØ±Ø¯ Ø§Ù„Ù‚Ø±Ø¢Ù†', morning:'Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­', evening:'Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡', salawat:'Ø§Ù„ØµÙ„Ø§Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ'
    };

    const missedAll = allKeys.filter(k => items.some(d => !d[k]));

    summaryEl.innerHTML = `
      <div>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ù„ØªØ²Ù… ÙÙŠÙ‡Ø§ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„: <strong>${fullDays}</strong></div>
      <div>Ù…ØªÙˆØ³Ø· ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£ÙŠØ§Ù…: <strong>${avgRating} â­</strong></div>
      <div>Ø£ÙƒØªØ± Ø­Ø§Ø¬Ø§Øª Ù…Ø­ØªØ§Ø¬Ø© ØªØ²Ø¨ÙŠØ·:
        <strong>
          ${
            missedAll.length
              ? missedAll.map(k => names[k]).join(' ØŒ ') + ' â€” Ø­Ø§ÙˆÙ„ ØªÙ„ØªØ²Ù… ğŸ’ª'
              : 'Ù…Ø´ Ù…Ø­ØªØ§Ø¬ Ù…Ø§ Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙƒ ğŸ‘'
          }
        </strong>
      </div>
    `;
  }

recalculateOldRatings();
loadToday();
loadArchive();
</script>

</body>
</html>
