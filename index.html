<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù…Ù†Ø¸Ù‘Ù… Ø±Ù…Ø¶Ø§Ù† Ø§Ù„ÙŠÙˆÙ…ÙŠ</title>
  <style>
:root {
  --bg-main: #f8f6f2;        
  --bg-soft: #f1e7d8;       
  --card-bg: #ffffff;        
  --border: #e3d8c7;

  --primary: #b08968;        
  --primary-soft: #b0896833;

  --accent: #7f5539;         
  --gold: #c6a75e;

  --text-main: #3e3e3e;
  --text-muted: #8a817c;

  --shadow: 0 8px 25px rgba(120, 95, 70, 0.12);
}

* {
  box-sizing: border-box;
  font-family: "Cairo", system-ui, -apple-system, Segoe UI, Roboto, Arial;
}

body {
  margin: 0;
  background: linear-gradient(160deg, var(--bg-main), #ede3d4);
  color: var(--text-main);
  min-height: 100vh;
}

/* ===== Header ===== */
header {
  padding: 30px 16px;
  text-align: center;
  background: var(--bg-soft);
  border-bottom: 1px solid var(--border);
}

header h1 {
  margin: 0 0 10px;
  font-size: 30px;
  font-weight: 700;
  color: var(--accent);
}

header p {
  margin: 0;
  color: var(--text-muted);
  font-size: 15px;
}

/* ===== Layout ===== */
.container {
  max-width: 1100px;
  margin: 0 auto;
  padding: 20px;
  display: grid;
  gap: 20px;
}

/* ===== Cards ===== */
.card {
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: 18px;
  padding: 20px;
  box-shadow: var(--shadow);
  transition: .3s ease;
}

.card:hover {
  border-color: var(--primary-soft);
}

.card h2 {
  margin-top: 0;
  margin-bottom: 15px;
  font-size: 20px;
  color: var(--primary);
}

/* ===== Grid ===== */
.grid {
  display: grid;
  gap: 14px;
}

.grid-2 {
  grid-template-columns: 1fr 1fr;
}

@media (max-width: 768px) {
  .grid-2 {
    grid-template-columns: 1fr;
  }
}

/* ===== Checklist ===== */
.checklist label {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 14px;
  border-radius: 12px;
  background: var(--bg-soft);
  cursor: pointer;
  transition: .25s ease;
  border: 1px solid transparent;
}

.checklist label:hover {
  border-color: var(--primary-soft);
  background: #f5eee3;
}

.checklist input {
  width: 18px;
  height: 18px;
  accent-color: var(--primary);
}

/* ===== Buttons ===== */
.btn {
  border: none;
  border-radius: 14px;
  padding: 12px 16px;
  background: linear-gradient(135deg, #b08968, #a47148);
  color: #ffffff;
  font-weight: 700;
  cursor: pointer;
  transition: .3s ease;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 18px rgba(160,120,80,.25);
}

.btn.secondary {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--accent);
}

.btn.secondary:hover {
  border-color: var(--primary);
  color: var(--primary);
}

/* ===== Archive Grid ===== */
.archive-grid {
  display: grid;
  gap: 16px;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  margin-top: 15px;
}

.archive-item {
  background: var(--bg-soft);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 15px;
  transition: .3s ease;
}

.archive-item:hover {
  transform: translateY(-4px);
  border-color: var(--primary-soft);
}

/* ===== Archive Toggle Animation ===== */
.archive-wrapper {
  overflow: hidden;
  max-height: 0;
  transition: max-height .5s ease;
}

.archive-wrapper.open {
  max-height: 2000px;
}

/* ===== Rating Box ===== */
.rating-box {
  margin-top: 15px;
  font-size: 17px;
  color: var(--gold);
  font-weight: 600;
}

/* ===== Summary ===== */
#summary div {
  background: var(--bg-soft);
  padding: 12px;
  border-radius: 12px;
  border: 1px solid var(--border);
}

/* ===== Footer ===== */
footer {
  text-align: center;
  color: var(--text-muted);
  padding: 25px 12px;
  border-top: 1px solid var(--border);
  margin-top: 30px;
  font-size: 14px;
}

/* ===== Small Badge ===== */
.badge {
  color: var(--primary);
  font-weight: 600;
  margin-top: 5px;
  display: inline-block;
}

    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø³Ø§ÙØ§Øª */

.actions {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.checklist {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.card .card {
  margin-top: 10px;
}

.card h3 {
  margin-bottom: 10px;
}
  </style>
</head>
<body>

<header>
  <h1>Ù…Ù†Ø¸Ù‘Ù… Ø±Ù…Ø¶Ø§Ù† Ø§Ù„ÙŠÙˆÙ…ÙŠ ğŸŒ™</h1>
  <p>Ù†Ø¸Ù‘Ù… ØµÙ„Ø§ØªÙƒ ÙˆÙˆØ±Ø¯Ùƒ ÙˆØ°ÙƒØ±Ùƒ ÙŠÙˆÙ… Ø¨ÙŠÙˆÙ… Ù„Ø­Ø¯ Ø¢Ø®Ø± Ø±Ù…Ø¶Ø§Ù†</p>
</header>

<main class="container">
  <section class="card">
    <h2>ğŸ“… ÙŠÙˆÙ…Ùƒ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡</h2>
    <div id="todayDate" class="badge"></div>

    <div class="grid grid-2" style="margin-top:12px">
      <div class="card">
        <h3>ğŸ•Œ Ø§Ù„ØµÙ„ÙˆØ§Øª</h3>
        <div class="checklist">
          <label><input type="checkbox" data-key="fajr"> Ø§Ù„ÙØ¬Ø±</label>
          <label><input type="checkbox" data-key="dhuhr"> Ø§Ù„Ø¸Ù‡Ø±</label>
          <label><input type="checkbox" data-key="asr"> Ø§Ù„Ø¹ØµØ±</label>
          <label><input type="checkbox" data-key="maghrib"> Ø§Ù„Ù…ØºØ±Ø¨</label>
          <label><input type="checkbox" data-key="isha"> Ø§Ù„Ø¹Ø´Ø§Ø¡</label>
        </div>
      </div>

      <div class="card">
        <h3>ğŸ“– Ø§Ù„Ù‚Ø±Ø¢Ù†</h3>
        <div class="checklist">
          <label><input type="checkbox" data-key="wird"> ÙˆØ±Ø¯ Ø§Ù„ÙŠÙˆÙ… Ø§ØªÙ‚Ø±ÙŠ</label>
        </div>
        <h3 style="margin-top:10px">ğŸ¤² Ø§Ù„Ø£Ø°ÙƒØ§Ø±</h3>
        <div class="checklist">
          <label><input type="checkbox" data-key="morning"> Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­</label>
          <label><input type="checkbox" data-key="evening"> Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡</label>
          <label><input type="checkbox" data-key="salawat"> ØµÙ„Ø§Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ</label>
        </div>
      </div>
    </div>

    <div class="rating-box">
      â­ ØªÙ‚ÙŠÙŠÙ…Ùƒ Ø§Ù„ÙŠÙˆÙ…: <span id="autoRating">0 / 5</span>
    </div>

    <div class="actions" style="margin-top:12px">
      <button class="btn" id="finishDay">âœ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ… ÙˆØ­ÙØ¸Ù‡ ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ</button>
      <button class="btn secondary" id="resetToday">â™»ï¸ ØªØµÙÙŠØ± Ø§Ù„ÙŠÙˆÙ…</button>
    </div>
  </section>

<section class="card">
  <h2>ğŸ“‚ Ø§Ù„Ø£Ø±Ø´ÙŠÙ</h2>

  <button class="btn secondary" id="toggleArchive">
    ğŸ“‚ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø´ÙŠÙ
  </button>

  <div class="archive-wrapper" id="archiveWrapper">
    <div id="archiveList" class="archive-grid"></div>
  </div>
</section>

<section class="card">
  <h2>ğŸ—‘ Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª</h2>

  <button class="btn secondary" id="toggleTrash">
    ğŸ—‘ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª
  </button>

  <div class="archive-wrapper" id="trashWrapper">
    <div id="trashList" class="archive-grid"></div>
  </div>
</section>

  <section class="card">
    <h2>ğŸ“Š Ù…Ù„Ø®Øµ Ø±Ù…Ø¶Ø§Ù†</h2>
    <div id="summary" class="grid"></div>
  </section>
</main>

<footer>
  Ø±Ø¨Ù†Ø§ ÙŠØªÙ‚Ø¨Ù„ Ù…Ù†ÙƒÙ… ÙˆÙŠØ¹ÙŠÙ†ÙƒÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§Ø¹Ø© Ø§Ø®ÙˆÙƒÙ… Ø§Ø­Ù…Ø¯ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… ğŸ¤
</footer>

<script>
  const todayKey = () => new Date().toISOString().slice(0,10);
  const getStore = () => JSON.parse(localStorage.getItem('ramadan-tracker') || '{"archive":{}}');
  const setStore = (data) => localStorage.setItem('ramadan-tracker', JSON.stringify(data));

  const todayDateEl = document.getElementById('todayDate');
  const archiveList = document.getElementById('archiveList');
  const summaryEl = document.getElementById('summary');
  const autoRatingEl = document.getElementById('autoRating');

  const allKeys = ['fajr','dhuhr','asr','maghrib','isha','wird','morning','evening','salawat'];

  function formatDate(dStr){
    const d = new Date(dStr);
    return d.toLocaleDateString('ar-EG', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
  }

  function calculateRating(data){
    const done = allKeys.filter(k => data[k]).length;
    return Math.round((done / allKeys.length) * 5);
  }

  function recalculateOldRatings() {
  const store = getStore();
  if (!store.archive) return;

  Object.keys(store.archive).forEach(date => {
    const dayData = store.archive[date];
    dayData.rating = calculateRating(dayData);
  });

  setStore(store);
}

  function updateAutoRating(){
    const store = getStore();
    const today = store[todayKey()] || {};
    const rating = calculateRating(today);
    autoRatingEl.textContent = rating + " / 5";
    return rating;
  }

  function loadToday(){
    todayDateEl.textContent = formatDate(todayKey());
    const store = getStore();
    const today = store[todayKey()] || {};
    document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
      cb.checked = !!today[cb.dataset.key];
    });
    updateAutoRating();
  }

  document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
    cb.addEventListener('change', () => {
      const store = getStore();
      store[todayKey()] = store[todayKey()] || {};
      store[todayKey()][cb.dataset.key] = cb.checked;
      store[todayKey()].rating = calculateRating(store[todayKey()]);
      setStore(store);
      updateAutoRating();
    });
  });

  document.getElementById('finishDay').onclick = () => {
    const store = getStore();
    const todayData = store[todayKey()] || {};
    store.archive = store.archive || {};
    store.archive[todayKey()] = { ...todayData, date: todayKey() };
    delete store[todayKey()];
    setStore(store);
    loadArchive();
    resetToday();
    alert('Ø§ØªØ­ÙØ¸ ÙŠÙˆÙ…Ùƒ ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ âœ¨');
  };

  document.getElementById('resetToday').onclick = resetToday;

  function resetToday(){
    document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
    const store = getStore();
    delete store[todayKey()];
    setStore(store);
    updateAutoRating();
  }

  function loadArchive(){
    const store = getStore();
    const items = Object.values(store.archive || {}).sort((a,b)=> b.date.localeCompare(a.date));
    archiveList.innerHTML = items.map(d => {
    const prayers = ['fajr','dhuhr','asr','maghrib','isha'].filter(k => d[k]).length;

  return `
    <div class="archive-item">
      <div><strong>ğŸ“… ${formatDate(d.date)}</strong></div>
      <div>ğŸ•Œ Ø§Ù„ØµÙ„ÙˆØ§Øª: ${prayers}/5</div>
      <div>ğŸ“– Ø§Ù„Ù‚Ø±Ø¢Ù†: ${d.wird ? 'ØªÙ…' : 'â€”'}</div>
      <div>ğŸ¤² Ø§Ù„Ø£Ø°ÙƒØ§Ø±: ${['morning','evening','salawat'].filter(k=>d[k]).length}/3</div>
      <div>â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${d.rating || 0} / 5</div>

      <button class="btn secondary delete-day" data-date="${d.date}">
        ğŸ—‘ Ø­Ø°Ù Ø§Ù„ÙŠÙˆÙ…
      </button>
    </div>
  `;
}).join('') || '<p style="color:#9ca3af">Ù„Ø³Ù‡ Ù…ÙÙŠØ´ Ø£ÙŠØ§Ù… Ù…Ø­ÙÙˆØ¸Ø©.</p>';

    loadSummary(items);
  }

  const archiveWrapper = document.getElementById("archiveWrapper");
const toggleBtn = document.getElementById("toggleArchive");

toggleBtn.addEventListener("click", () => {
  archiveWrapper.classList.toggle("open");

  if (archiveWrapper.classList.contains("open")) {
    toggleBtn.textContent = "âŒ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø±Ø´ÙŠÙ";
  } else {
    toggleBtn.textContent = "ğŸ“‚ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø´ÙŠÙ";
  }
});

  function loadSummary(items){
    if(!items.length){
      summaryEl.innerHTML = '<p style="color:#9ca3af">Ø§Ø¨Ø¯Ø£ Ø£ÙˆÙ„ ÙŠÙˆÙ… ÙˆÙ‡ØªØ´ÙˆÙ Ø§Ù„Ù…Ù„Ø®Øµ Ù‡Ù†Ø§ âœ¨</p>';
      return;
    }

    const fullDays = items.filter(d => allKeys.every(k => d[k])).length;
    const avgRating = (items.reduce((s,d)=> s + (d.rating||0), 0) / items.length).toFixed(1);

    const names = {
      fajr:'Ø§Ù„ÙØ¬Ø±', dhuhr:'Ø§Ù„Ø¸Ù‡Ø±', asr:'Ø§Ù„Ø¹ØµØ±', maghrib:'Ø§Ù„Ù…ØºØ±Ø¨', isha:'Ø§Ù„Ø¹Ø´Ø§Ø¡',
      wird:'ÙˆØ±Ø¯ Ø§Ù„Ù‚Ø±Ø¢Ù†', morning:'Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­', evening:'Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡', salawat:'Ø§Ù„ØµÙ„Ø§Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ'
    };

    const missedAll = allKeys.filter(k => items.some(d => !d[k]));

    summaryEl.innerHTML = `
      <div>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ù„ØªØ²Ù… ÙÙŠÙ‡Ø§ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„: <strong>${fullDays}</strong></div>
      <div>Ù…ØªÙˆØ³Ø· ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£ÙŠØ§Ù…: <strong>${avgRating} â­</strong></div>
      <div>Ø£ÙƒØªØ± Ø­Ø§Ø¬Ø§Øª Ù…Ø­ØªØ§Ø¬Ø© ØªØ²Ø¨ÙŠØ·:
        <strong>
          ${
            missedAll.length
              ? missedAll.map(k => names[k]).join(' ØŒ ') + ' â€” Ø­Ø§ÙˆÙ„ ØªÙ„ØªØ²Ù… ğŸ’ª'
              : 'Ù…Ø´ Ù…Ø­ØªØ§Ø¬ Ù…Ø§ Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙƒ ğŸ‘'
          }
        </strong>
      </div>
    `;
  }

  document.addEventListener("click", function(e){

  if(e.target.classList.contains("delete-day")){
    const date = e.target.dataset.date;
    const store = getStore();

    store.trash = store.trash || {};
    store.trash[date] = store.archive[date];

    delete store.archive[date];
    setStore(store);

    loadArchive();
    loadTrash();
  }

  if(e.target.classList.contains("restore-day")){
    const date = e.target.dataset.date;
    const store = getStore();

    store.archive[date] = store.trash[date];
    delete store.trash[date];

    setStore(store);
    loadArchive();
    loadTrash();
  }

  if(e.target.classList.contains("delete-forever")){
    const date = e.target.dataset.date;
    const store = getStore();

    delete store.trash[date];
    setStore(store);

    loadTrash();
  }

});

function loadTrash(){
  const store = getStore();
  const trash = Object.values(store.trash || {});

  const trashList = document.getElementById("trashList");

  trashList.innerHTML = trash.map(d => {
    return `
      <div class="archive-item">
        <div><strong>ğŸ“… ${formatDate(d.date)}</strong></div>

        <button class="btn restore-day" data-date="${d.date}">
          â™»ï¸ Ø§Ø³ØªØ±Ø¬Ø§Ø¹
        </button>

        <button class="btn secondary delete-forever" data-date="${d.date}">
          âŒ Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ
        </button>
      </div>
    `;
  }).join('') || '<p style="color:#9ca3af">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ© </p>';
}

const trashWrapper = document.getElementById("trashWrapper");
const toggleTrashBtn = document.getElementById("toggleTrash");

toggleTrashBtn.addEventListener("click", () => {
  trashWrapper.classList.toggle("open");

  if (trashWrapper.classList.contains("open")) {
    toggleTrashBtn.textContent = "âŒ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª";
  } else {
    toggleTrashBtn.textContent = "ğŸ—‘ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª";
  }
});

recalculateOldRatings();
loadToday();
loadArchive();
loadTrash();
</script>

</body>
</html>
